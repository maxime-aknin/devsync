var diffDOM=function(){var e=Math.min,t=Math.max,o=Math.abs;function n(e,t,o){var l;return"#text"===e.nodeName?l=o.document.createTextNode(e.data):"#comment"===e.nodeName?l=o.document.createComment(e.data):(t?l=o.document.createElementNS("http://www.w3.org/2000/svg",e.nodeName):"svg"===e.nodeName.toLowerCase()?(l=o.document.createElementNS("http://www.w3.org/2000/svg","svg"),t=!0):l=o.document.createElement(e.nodeName),e.attributes&&Object.entries(e.attributes).forEach(function(e){var t=e[0],o=e[1];return l.setAttribute(t,o)}),e.childNodes&&e.childNodes.forEach(function(e){return l.appendChild(n(e,t,o))}),o.valueDiffing&&(e.value&&(l.value=e.value),e.checked&&(l.checked=e.checked),e.selected&&(l.selected=e.selected))),l}function l(e,t){for(t=t.slice();0<t.length;){if(!e.childNodes)return!1;var o=t.splice(0,1)[0];e=e.childNodes[o]}return e}function a(e,t,o){var a,d,i,u,p,r=l(e,t[o._const.route]),h={diff:t,node:r};if(o.preDiffApply(h))return!0;switch(t[o._const.action]){case o._const.addAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(t[o._const.name],t[o._const.value]);break;case o._const.modifyAttribute:if(!r||!r.setAttribute)return!1;r.setAttribute(t[o._const.name],t[o._const.newValue]),"INPUT"===r.nodeName&&"value"===t[o._const.name]&&(r.value=t[o._const.newValue]);break;case o._const.removeAttribute:if(!r||!r.removeAttribute)return!1;r.removeAttribute(t[o._const.name]);break;case o._const.modifyTextElement:if(!r||3!==r.nodeType)return!1;o.textDiff(r,r.data,t[o._const.oldValue],t[o._const.newValue]);break;case o._const.modifyValue:if(!r||"undefined"==typeof r.value)return!1;r.value=t[o._const.newValue];break;case o._const.modifyComment:if(!r||"undefined"==typeof r.data)return!1;o.textDiff(r,r.data,t[o._const.oldValue],t[o._const.newValue]);break;case o._const.modifyChecked:if(!r||"undefined"==typeof r.checked)return!1;r.checked=t[o._const.newValue];break;case o._const.modifySelected:if(!r||"undefined"==typeof r.selected)return!1;r.selected=t[o._const.newValue];break;case o._const.replaceElement:r.parentNode.replaceChild(n(t[o._const.newValue],"http://www.w3.org/2000/svg"===r.namespaceURI,o),r);break;case o._const.relocateGroup:u=Array.apply(void 0,Array(t.groupLength)).map(function(){return r.removeChild(r.childNodes[t[o._const.from]])}),u.forEach(function(e,n){0===n&&(d=r.childNodes[t[o._const.to]]),r.insertBefore(e,d||null)});break;case o._const.removeElement:r.parentNode.removeChild(r);break;case o._const.addElement:i=t[o._const.route].slice(),p=i.splice(i.length-1,1)[0],r=l(e,i),r.insertBefore(n(t[o._const.element],"http://www.w3.org/2000/svg"===r.namespaceURI,o),r.childNodes[p]||null);break;case o._const.removeTextElement:if(!r||3!==r.nodeType)return!1;r.parentNode.removeChild(r);break;case o._const.addTextElement:if(i=t[o._const.route].slice(),p=i.splice(i.length-1,1)[0],a=o.document.createTextNode(t[o._const.value]),r=l(e,i),!r||!r.childNodes)return!1;r.insertBefore(a,r.childNodes[p]||null);break;default:console.log("unknown action");}return h.newNode=a,o.postDiffApply(h),!0}function d(e,t,o){return t.every(function(t){return a(e,t,o)})}function i(e,t,o){var n=e[t];e[t]=e[o],e[o]=n}function c(e,t,o){switch(t[o._const.action]){case o._const.addAttribute:t[o._const.action]=o._const.removeAttribute,a(e,t,o);break;case o._const.modifyAttribute:i(t,o._const.oldValue,o._const.newValue),a(e,t,o);break;case o._const.removeAttribute:t[o._const.action]=o._const.addAttribute,a(e,t,o);break;case o._const.modifyTextElement:i(t,o._const.oldValue,o._const.newValue),a(e,t,o);break;case o._const.modifyValue:i(t,o._const.oldValue,o._const.newValue),a(e,t,o);break;case o._const.modifyComment:i(t,o._const.oldValue,o._const.newValue),a(e,t,o);break;case o._const.modifyChecked:i(t,o._const.oldValue,o._const.newValue),a(e,t,o);break;case o._const.modifySelected:i(t,o._const.oldValue,o._const.newValue),a(e,t,o);break;case o._const.replaceElement:i(t,o._const.oldValue,o._const.newValue),a(e,t,o);break;case o._const.relocateGroup:i(t,o._const.from,o._const.to),a(e,t,o);break;case o._const.removeElement:t[o._const.action]=o._const.addElement,a(e,t,o);break;case o._const.addElement:t[o._const.action]=o._const.removeElement,a(e,t,o);break;case o._const.removeTextElement:t[o._const.action]=o._const.addTextElement,a(e,t,o);break;case o._const.addTextElement:t[o._const.action]=o._const.removeTextElement,a(e,t,o);break;default:console.log("unknown action");}}function u(e,t,o){t.length||(t=[t]),t=t.slice(),t.reverse(),t.forEach(function(t){c(e,t,o)})}function p(e){var t=[];return t.push(e.nodeName),"#text"!==e.nodeName&&"#comment"!==e.nodeName&&e.attributes&&(e.attributes["class"]&&t.push(e.nodeName+"."+e.attributes["class"].replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id)),t}function r(e){var t={},o={};return e.forEach(function(e){p(e).forEach(function(e){var n=(e in t),l=(e in o);n||l?n&&(delete t[e],o[e]=!0):t[e]=!0})}),t}function h(e,t){var o=r(e),n=r(t),l={};return Object.keys(o).forEach(function(e){n[e]&&(l[e]=!0)}),l}function m(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(m)}function _(e,t){if(!["nodeName","value","checked","selected","data"].every(function(o){return e[o]===t[o]}))return!1;if(!!e.attributes!==!!t.attributes)return!1;if(!!e.childNodes!==!!t.childNodes)return!1;if(e.attributes){var o=Object.keys(e.attributes),n=Object.keys(t.attributes);if(o.length!==n.length)return!1;if(!o.every(function(o){return e.attributes[o]===t.attributes[o]}))return!1}if(e.childNodes){if(e.childNodes.length!==t.childNodes.length)return!1;if(!e.childNodes.every(function(e,o){return _(e,t.childNodes[o])}))return!1}return!0}function f(e,t,o,n,l){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!l||e.data===t.data;if(e.nodeName in o)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;var a=e.nodeName+"#"+e.attributes.id;if(a in o)return!0}if(e.attributes["class"]&&e.attributes["class"]===t.attributes["class"]){var d=e.nodeName+"."+e.attributes["class"].replace(/ /g,".");if(d in o)return!0}}if(n)return!0;var i=e.childNodes?e.childNodes.slice().reverse():[],c=t.childNodes?t.childNodes.slice().reverse():[];if(i.length!==c.length)return!1;if(l)return i.every(function(e,t){return e.nodeName===c[t].nodeName});var u=h(i,c);return i.every(function(e,t){return f(e,c[t],u,!0,!0)})}function g(e){return JSON.parse(JSON.stringify(e))}function V(e,t,o,n){var l=0,a=[],d=e.length,i=t.length,c=Array.apply(void 0,Array(d+1)).map(function(){return[]}),u=h(e,t),r=d===i;r&&e.some(function(e,o){var n=p(e),l=p(t[o]);return n.length===l.length?(n.some(function(e,t){if(e!==l[t])return r=!1,!0}),!!!r)||void 0:(r=!1,!0)});for(var m,_=0;_<d;_++){m=e[_];for(var g,V=0;V<i;V++)g=t[V],o[_]||n[V]||!f(m,g,u,r)?c[_+1][V+1]=0:(c[_+1][V+1]=c[_][V]?c[_][V]+1:1,c[_+1][V+1]>=l&&(l=c[_+1][V+1],a=[_+1,V+1]))}return 0!==l&&{oldValue:a[0]-l,newValue:a[1]-l,length:l}}function N(e,t){return Array.apply(void 0,Array(e)).map(function(){return t})}function y(e,t,o){var n=e.childNodes?N(e.childNodes.length,!0):[],l=t.childNodes?N(t.childNodes.length,!0):[],a=0;return o.forEach(function(e){for(var t=e.oldValue+e.length,o=e.newValue+e.length,d=e.oldValue;d<t;d+=1)n[d]=a;for(var i=e.newValue;i<o;i+=1)l[i]=a;a+=1}),{gaps1:n,gaps2:l}}function v(e,t){for(var o=e.childNodes?e.childNodes:[],n=t.childNodes?t.childNodes:[],l=N(o.length,!1),a=N(n.length,!1),d=[],c=!0,u=function(){return arguments[1]},p=function(e){l[c.oldValue+e]=!0,a[c.newValue+e]=!0};c;)if(c=V(o,n,l,a),c){d.push(c);var r=Array.apply(void 0,Array(c.length)).map(u);r.forEach(function(e){return p(e)})}return e.subsets=d,e.subsetsAge=100,d}function b(e,t){var o,n,l=e;for(t=t.slice();0<t.length;){if(!l.childNodes)return!1;n=t.splice(0,1)[0],o=l,l=l.childNodes[n]}return{node:l,parentNode:o,nodeIndex:n}}function E(e,t,o){var n=b(e,t[o._const.route]),l=n.node,a=n.parentNode,d=n.nodeIndex,i=[],u={diff:t,node:l};if(o.preVirtualDiffApply(u))return!0;var p,r,h,m;switch(t[o._const.action]){case o._const.addAttribute:l.attributes||(l.attributes={}),l.attributes[t[o._const.name]]=t[o._const.value],"checked"===t[o._const.name]?l.checked=!0:"selected"===t[o._const.name]?l.selected=!0:"INPUT"===l.nodeName&&"value"===t[o._const.name]&&(l.value=t[o._const.value]);break;case o._const.modifyAttribute:l.attributes[t[o._const.name]]=t[o._const.newValue];break;case o._const.removeAttribute:delete l.attributes[t[o._const.name]],0===Object.keys(l.attributes).length&&delete l.attributes,"checked"===t[o._const.name]?l.checked=!1:"selected"===t[o._const.name]?delete l.selected:"INPUT"===l.nodeName&&"value"===t[o._const.name]&&delete l.value;break;case o._const.modifyTextElement:l.data=t[o._const.newValue];break;case o._const.modifyValue:l.value=t[o._const.newValue];break;case o._const.modifyComment:l.data=t[o._const.newValue];break;case o._const.modifyChecked:l.checked=t[o._const.newValue];break;case o._const.modifySelected:l.selected=t[o._const.newValue];break;case o._const.replaceElement:p=g(t[o._const.newValue]),p.outerDone=!0,p.innerDone=!0,p.valueDone=!0,a.childNodes[d]=p;break;case o._const.relocateGroup:r=l.childNodes.splice(t[o._const.from],t.groupLength).reverse(),r.forEach(function(e){return l.childNodes.splice(t[o._const.to],0,e)}),l.subsets&&l.subsets.forEach(function(e){if(t[o._const.from]<t[o._const.to]&&e.oldValue<=t[o._const.to]&&e.oldValue>t[o._const.from]){e.oldValue-=t.groupLength;var n=e.oldValue+e.length-t[o._const.to];0<n&&(i.push({oldValue:t[o._const.to]+t.groupLength,newValue:e.newValue+e.length-n,length:n}),e.length-=n)}else if(t[o._const.from]>t[o._const.to]&&e.oldValue>t[o._const.to]&&e.oldValue<t[o._const.from]){e.oldValue+=t.groupLength;var l=e.oldValue+e.length-t[o._const.to];0<l&&(i.push({oldValue:t[o._const.to]+t.groupLength,newValue:e.newValue+e.length-l,length:l}),e.length-=l)}else e.oldValue===t[o._const.from]&&(e.oldValue=t[o._const.to])});break;case o._const.removeElement:a.childNodes.splice(d,1),a.subsets&&a.subsets.forEach(function(e){e.oldValue>d?e.oldValue-=1:e.oldValue===d?e.delete=!0:e.oldValue<d&&e.oldValue+e.length>d&&(e.oldValue+e.length-1===d?e.length--:(i.push({newValue:e.newValue+d-e.oldValue,oldValue:d,length:e.length-d+e.oldValue-1}),e.length=d-e.oldValue))}),l=a;break;case o._const.addElement:h=t[o._const.route].slice(),m=h.splice(h.length-1,1)[0],l=b(e,h).node,p=g(t[o._const.element]),p.outerDone=!0,p.innerDone=!0,p.valueDone=!0,l.childNodes||(l.childNodes=[]),m>=l.childNodes.length?l.childNodes.push(p):l.childNodes.splice(m,0,p),l.subsets&&l.subsets.forEach(function(e){if(e.oldValue>=m)e.oldValue+=1;else if(e.oldValue<m&&e.oldValue+e.length>m){var t=e.oldValue+e.length-m;i.push({newValue:e.newValue+e.length-t,oldValue:m+1,length:t}),e.length-=t}});break;case o._const.removeTextElement:a.childNodes.splice(d,1),"TEXTAREA"===a.nodeName&&delete a.value,a.subsets&&a.subsets.forEach(function(e){e.oldValue>d?e.oldValue-=1:e.oldValue===d?e.delete=!0:e.oldValue<d&&e.oldValue+e.length>d&&(e.oldValue+e.length-1===d?e.length--:(i.push({newValue:e.newValue+d-e.oldValue,oldValue:d,length:e.length-d+e.oldValue-1}),e.length=d-e.oldValue))}),l=a;break;case o._const.addTextElement:h=t[o._const.route].slice(),m=h.splice(h.length-1,1)[0],p={},p.nodeName="#text",p.data=t[o._const.value],l=b(e,h).node,l.childNodes||(l.childNodes=[]),m>=l.childNodes.length?l.childNodes.push(p):l.childNodes.splice(m,0,p),"TEXTAREA"===l.nodeName&&(l.value=t[o._const.newValue]),l.subsets&&l.subsets.forEach(function(e){if(e.oldValue>=m&&(e.oldValue+=1),e.oldValue<m&&e.oldValue+e.length>m){var t=e.oldValue+e.length-m;i.push({newValue:e.newValue+e.length-t,oldValue:m+1,length:t}),e.length-=t}});break;default:console.log("unknown action");}return l.subsets&&(l.subsets=l.subsets.filter(function(e){return!e.delete&&e.oldValue!==e.newValue}),i.length&&(l.subsets=l.subsets.concat(i))),u.newNode=p,void o.postVirtualDiffApply(u)}function x(e,t,o){return t.forEach(function(t){E(e,t,o)}),!0}function w(e,t){void 0===t&&(t={});var o={nodeName:e.nodeName};if("#text"===o.nodeName||"#comment"===o.nodeName)o.data=e.data;else{if(e.attributes&&0<e.attributes.length){o.attributes={};var n=Array.prototype.slice.call(e.attributes);n.forEach(function(e){return o.attributes[e.name]=e.value})}if("TEXTAREA"===o.nodeName)o.value=e.value;else if(e.childNodes&&0<e.childNodes.length){o.childNodes=[];var l=Array.prototype.slice.call(e.childNodes);l.forEach(function(e){return o.childNodes.push(w(e,t))})}t.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?o.checked=e.checked:void 0!==e.value&&(o.value=e.value),void 0!==e.selected&&(o.selected=e.selected))}return o}function D(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function k(e){var t={nodeName:"",attributes:{}},o=e.match(/<\/?([^\s]+?)[/\s>]/);if(o&&(t.nodeName=o[1].toUpperCase(),(G[o[1].toLowerCase()]||"/"===e.charAt(e.length-2))&&(t.voidElement=!0),t.nodeName.startsWith("!--"))){var n=e.indexOf("-->");return{type:"comment",data:-1===n?"":e.slice(4,n)}}for(var l=new RegExp(R),a=null,d=!1;!d;)if(a=l.exec(e),null===a)d=!0;else if(a[0].trim())if(a[1]){var i=a[1].trim(),c=[i,""];-1<i.indexOf("=")&&(c=i.split("=")),t.attributes[c[0]]=c[1],l.lastIndex--}else a[2]&&(t.attributes[a[2]]=a[3].trim().substring(1,a[3].length-1));return t}function A(e,t){void 0===t&&(t={components:I});var o,n=[],l=-1,a=[],d=!1;return e.replace(S,function(i,c){if(d){if(i!=="</"+o.nodeName+">")return;d=!1}var u,p="/"!==i.charAt(1),r=i.startsWith("<!--"),h=c+i.length,m=e.charAt(h);if(r){var _=k(i);return 0>l?(n.push(_),n):(u=a[l],u&&(!u.childNodes&&(u.childNodes=[]),u.childNodes.push(_)),n)}if(p&&(o=k(i),l++,"tag"===o.type&&t.components[o.nodeName]&&(o.type="component",d=!0),!o.voidElement&&!d&&m&&"<"!==m&&(!o.childNodes&&(o.childNodes=[]),o.childNodes.push({nodeName:"#text",data:D(e.slice(h,e.indexOf("<",h)))})),0===l&&n.push(o),u=a[l-1],u&&(!u.childNodes&&(u.childNodes=[]),u.childNodes.push(o)),a[l]=o),(!p||o.voidElement)&&(l--,!d&&"<"!==m&&m)){u=-1===l?n:a[l].childNodes||[];var f=e.indexOf("<",h),g=D(e.slice(h,-1===f?void 0:f));u.push({nodeName:"#text",data:g})}}),n[0]}function C(e){return delete e.voidElement,e.childNodes&&e.childNodes.forEach(function(e){return C(e)}),e}function T(e){return C(A(e))}var O=function(e){var t=this;void 0===e&&(e={}),Object.entries(e).forEach(function(e){var o=e[0],n=e[1];return t[o]=n})};O.prototype.toString=function(){return JSON.stringify(this)},O.prototype.setValue=function(e,t){return this[e]=t,this};var L=function(){this.list=[]};L.prototype.add=function(e){var t;(t=this.list).push.apply(t,e)},L.prototype.forEach=function(e){this.list.forEach(function(t){return e(t)})};var S=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,I=Object.create?Object.create(null):{},R=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,G={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},j=function(e,t,o){this.options=o,this.t1=e instanceof HTMLElement?w(e,this.options):"string"==typeof e?T(e,this.options):JSON.parse(JSON.stringify(e)),this.t2=t instanceof HTMLElement?w(t,this.options):"string"==typeof t?T(t,this.options):JSON.parse(JSON.stringify(t)),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=w(e,this.options),this.t2Orig=w(t,this.options)),this.tracker=new L};j.prototype.init=function(){return this.findDiffs(this.t1,this.t2)},j.prototype.findDiffs=function(e,t){var o;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));o=this.findNextDiff(e,t,[]),0!==o.length||_(e,t)||(this.foundAll?console.error("Could not find remaining diffs!"):(this.foundAll=!0,m(e),o=this.findNextDiff(e,t,[]))),0<o.length&&(this.foundAll=!1,this.tracker.add(o),x(e,o,this.options))}while(0<o.length);return this.tracker.list},j.prototype.findNextDiff=function(e,t,o){var n,l;if(this.options.maxDepth&&o.length>this.options.maxDepth)return[];if(!e.outerDone){if(n=this.findOuterDiff(e,t,o),this.options.filterOuterDiff&&(l=this.options.filterOuterDiff(e,t,n),l&&(n=l)),0<n.length)return e.outerDone=!0,n;e.outerDone=!0}if(!e.innerDone){if(n=this.findInnerDiff(e,t,o),0<n.length)return n;e.innerDone=!0}if(this.options.valueDiffing&&!e.valueDone){if(n=this.findValueDiff(e,t,o),0<n.length)return e.valueDone=!0,n;e.valueDone=!0}return[]},j.prototype.findOuterDiff=function(e,t,n){var l,a,d,c,u,p,r=[];if(e.nodeName!==t.nodeName){if(!n.length)throw new Error("Top level nodes have to be of the same kind.");return[new O().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,g(e)).setValue(this.options._const.newValue,g(t)).setValue(this.options._const.route,n)]}if(n.length&&this.options.maxNodeDiffCount<o((e.childNodes||[]).length-(t.childNodes||[]).length))return[new O().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,g(e)).setValue(this.options._const.newValue,g(t)).setValue(this.options._const.route,n)];if(e.data!==t.data)return"#text"===e.nodeName?[new O().setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,n).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)]:[new O().setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,n).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)];for(a=e.attributes?Object.keys(e.attributes).sort():[],d=t.attributes?Object.keys(t.attributes).sort():[],c=a.length,p=0;p<c;p++)l=a[p],u=d.indexOf(l),-1===u?r.push(new O().setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,n).setValue(this.options._const.name,l).setValue(this.options._const.value,e.attributes[l])):(d.splice(u,1),e.attributes[l]!==t.attributes[l]&&r.push(new O().setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,n).setValue(this.options._const.name,l).setValue(this.options._const.oldValue,e.attributes[l]).setValue(this.options._const.newValue,t.attributes[l])));for(c=d.length,p=0;p<c;p++)l=d[p],r.push(new O().setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,n).setValue(this.options._const.name,l).setValue(this.options._const.value,t.attributes[l]));return r},j.prototype.findInnerDiff=function(e,n,l){var a=e.childNodes?e.childNodes.slice():[],d=n.childNodes?n.childNodes.slice():[],c=t(a.length,d.length),u=o(a.length-d.length),p=[],r=0;if(!this.options.maxChildCount||c<this.options.maxChildCount){var h=e.subsets&&e.subsetsAge--,m=h?e.subsets:e.childNodes&&n.childNodes?v(e,n):[];if(0<m.length&&(p=this.attemptGroupRelocation(e,n,m,l,h),0<p.length))return p}for(var f=0;f<c;f+=1){var V=a[f],N=d[f];u&&(V&&!N?"#text"===V.nodeName?(p.push(new O().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,l.concat(r)).setValue(this.options._const.value,V.data)),r-=1):(p.push(new O().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,l.concat(r)).setValue(this.options._const.element,g(V))),r-=1):N&&!V&&("#text"===N.nodeName?p.push(new O().setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,l.concat(r)).setValue(this.options._const.value,N.data)):p.push(new O().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,l.concat(r)).setValue(this.options._const.element,g(N))))),V&&N&&(!this.options.maxChildCount||c<this.options.maxChildCount?p=p.concat(this.findNextDiff(V,N,l.concat(r))):!_(V,N)&&(a.length>d.length?("#text"===V.nodeName?p.push(new O().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,l.concat(r)).setValue(this.options._const.value,V.data)):p.push(new O().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,g(V)).setValue(this.options._const.route,l.concat(r))),a.splice(f,1),f-=1,r-=1,u-=1):a.length<d.length?(p=p.concat([new O().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,g(N)).setValue(this.options._const.route,l.concat(r))]),a.splice(f,0,{}),u-=1):p=p.concat([new O().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,g(V)).setValue(this.options._const.newValue,g(N)).setValue(this.options._const.route,l.concat(r))]))),r+=1}return e.innerDone=!0,p},j.prototype.attemptGroupRelocation=function(t,o,n,l,a){for(var d,i,c,u,p,r,h=y(t,o,n),m=h.gaps1,_=h.gaps2,V=e(m.length,_.length),N=[],v=0,b=0;v<V;b+=1,v+=1)if(a&&(!0===m[v]||!0===_[v]));else if(!0===m[v]){if(u=t.childNodes[b],"#text"!==u.nodeName)N.push(new O().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,l.concat(v)).setValue(this.options._const.element,g(u))),m.splice(v,1),V=e(m.length,_.length),v-=1;else if("#text"!==o.childNodes[v].nodeName)N.push(new O().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,l.concat(v)).setValue(this.options._const.value,u.data)),m.splice(v,1),V=e(m.length,_.length),v-=1;else if(u.data!==o.childNodes[v].data){for(r=b;t.childNodes.length>r+1&&"#text"===t.childNodes[r+1].nodeName;)if(r+=1,o.childNodes[v].data===t.childNodes[r].data){p=!0;break}if(!p)return N.push(new O().setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,l.concat(v)).setValue(this.options._const.oldValue,u.data).setValue(this.options._const.newValue,o.childNodes[v].data)),N}}else if(!0===_[v])u=o.childNodes[v],"#text"===u.nodeName?(N.push(new O().setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,l.concat(v)).setValue(this.options._const.value,u.data)),m.splice(v,0,!0),V=e(m.length,_.length),b-=1):(N.push(new O().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,l.concat(v)).setValue(this.options._const.element,g(u))),m.splice(v,0,!0),V=e(m.length,_.length),b-=1);else if(m[v]!==_[v]){if(0<N.length)return N;if(c=n[m[v]],i=e(c.newValue,t.childNodes.length-c.length),i!==c.oldValue){d=!1;for(var E=0;E<c.length;E+=1)f(t.childNodes[i+E],t.childNodes[c.oldValue+E],[],!1,!0)||(d=!0);if(d)return[new O().setValue(this.options._const.action,this.options._const.relocateGroup).setValue("groupLength",c.length).setValue(this.options._const.from,c.oldValue).setValue(this.options._const.to,i).setValue(this.options._const.route,l)]}}return N},j.prototype.findValueDiff=function(e,t,o){var n=[];return e.selected!==t.selected&&n.push(new O().setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,e.selected).setValue(this.options._const.newValue,t.selected).setValue(this.options._const.route,o)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&n.push(new O().setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,e.value||"").setValue(this.options._const.newValue,t.value||"").setValue(this.options._const.route,o)),e.checked!==t.checked&&n.push(new O().setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,e.checked).setValue(this.options._const.newValue,t.checked).setValue(this.options._const.route,o)),n};var P={debug:!1,diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff:function(e,t,o,n){e.data=n},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1,_const:!1,document:!!(window&&window.document)&&window.document},U=function(e){var t=this;if(void 0===e&&(e={}),this.options=e,Object.entries(P).forEach(function(e){var o=e[0],n=e[1];Object.prototype.hasOwnProperty.call(t.options,o)||(t.options[o]=n)}),!this.options._const){var o=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"];this.options._const={},this.options.compress?o.forEach(function(e,o){return t.options._const[e]=o}):o.forEach(function(e){return t.options._const[e]=e})}this.DiffFinder=j};U.prototype.apply=function(e,t){return d(e,t,this.options)},U.prototype.undo=function(e,t){return u(e,t,this.options)},U.prototype.diff=function(e,t){var o=new this.DiffFinder(e,t,this.options);return o.init()};var M=function(e){var t=this;void 0===e&&(e={}),this.pad="\u2502   ",this.padding="",this.tick=1,this.messages=[];var o=function(e,o){var n=e[o];e[o]=function(){for(var l=[],a=arguments.length;a--;)l[a]=arguments[a];t.fin(o,Array.prototype.slice.call(l));var d=n.apply(e,l);return t.fout(o,d),d}};for(var n in e)"function"==typeof e[n]&&o(e,n);this.log("\u250C TRACELOG START")};return M.prototype.fin=function(e,t){this.padding+=this.pad,this.log("\u251C\u2500> entering "+e,t)},M.prototype.fout=function(e,t){this.log("\u2502<\u2500\u2500\u2518 generated return value",t),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)},M.prototype.format=function(e,t){return function(e){for(e=""+e;4>e.length;)e="0"+e;return e}(t)+"> "+this.padding+e},M.prototype.log=function(){var e=Array.prototype.slice.call(arguments),t=function(e){return e?"string"==typeof e?e:e instanceof HTMLElement?e.outerHTML||"<empty>":e instanceof Array?"["+e.map(t).join(",")+"]":e.toString()||e.valueOf()||"<unknown>":"<falsey>"};e=e.map(t).join(", "),this.messages.push(this.format(e,this.tick++))},M.prototype.toString=function(){for(var e="\u2514\u2500\u2500\u2500";e.length<=this.padding.length+this.pad.length;)e+="\xD7   ";var t=this.padding;return this.padding="",e=this.format(e,this.tick),this.padding=t,this.messages.join("\n")+"\n"+e},{DiffDOM:U,TraceLogger:M,nodeToObj:w,stringToObj:T}}(),diffDOM=function(C){"use strict";var L=Math.min,S=Math.abs;function I(t,l,a){var n;return"#text"===t.nodeName?n=a.document.createTextNode(t.data):"#comment"===t.nodeName?n=a.document.createComment(t.data):(l?n=a.document.createElementNS("http://www.w3.org/2000/svg",t.nodeName):"svg"===t.nodeName.toLowerCase()?(n=a.document.createElementNS("http://www.w3.org/2000/svg","svg"),l=!0):n=a.document.createElement(t.nodeName),t.attributes&&Object.entries(t.attributes).forEach(function(l){var e=l[0],t=l[1];return n.setAttribute(e,t)}),t.childNodes&&t.childNodes.forEach(function(t){return n.appendChild(I(t,l,a))}),a.valueDiffing&&(t.value&&(n.value=t.value),t.checked&&(n.checked=t.checked),t.selected&&(n.selected=t.selected))),n}function t(n,l){for(l=l.slice();0<l.length;){if(!n.childNodes)return!1;var a=l.splice(0,1)[0];n=n.childNodes[a]}return n}function R(o,d,n){var e,p,h,m,_=t(o,d[n._const.route]),f={diff:d,node:_};if(n.preDiffApply(f))return!0;switch(d[n._const.action]){case n._const.addAttribute:if(!_||!_.setAttribute)return!1;_.setAttribute(d[n._const.name],d[n._const.value]);break;case n._const.modifyAttribute:if(!_||!_.setAttribute)return!1;_.setAttribute(d[n._const.name],d[n._const.newValue]),"INPUT"===_.nodeName&&"value"===d[n._const.name]&&(_.value=d[n._const.newValue]);break;case n._const.removeAttribute:if(!_||!_.removeAttribute)return!1;_.removeAttribute(d[n._const.name]);break;case n._const.modifyTextElement:if(!_||3!==_.nodeType)return!1;n.textDiff(_,_.data,d[n._const.oldValue],d[n._const.newValue]);break;case n._const.modifyValue:if(!_||void 0===_.value)return!1;_.value=d[n._const.newValue];break;case n._const.modifyComment:if(!_||void 0===_.data)return!1;n.textDiff(_,_.data,d[n._const.oldValue],d[n._const.newValue]);break;case n._const.modifyChecked:if(!_||void 0===_.checked)return!1;_.checked=d[n._const.newValue];break;case n._const.modifySelected:if(!_||void 0===_.selected)return!1;_.selected=d[n._const.newValue];break;case n._const.replaceElement:_.parentNode.replaceChild(I(d[n._const.newValue],"http://www.w3.org/2000/svg"===_.namespaceURI,n),_);break;case n._const.relocateGroup:Array.apply(void 0,Array(d.groupLength)).map(function(){return _.removeChild(_.childNodes[d[n._const.from]])}).forEach(function(o,e){0===e&&(p=_.childNodes[d[n._const.to]]),_.insertBefore(o,p||null)});break;case n._const.removeElement:_.parentNode.removeChild(_);break;case n._const.addElement:m=(h=d[n._const.route].slice()).splice(h.length-1,1)[0],(_=t(o,h)).insertBefore(I(d[n._const.element],"http://www.w3.org/2000/svg"===_.namespaceURI,n),_.childNodes[m]||null);break;case n._const.removeTextElement:if(!_||3!==_.nodeType)return!1;_.parentNode.removeChild(_);break;case n._const.addTextElement:if(m=(h=d[n._const.route].slice()).splice(h.length-1,1)[0],e=n.document.createTextNode(d[n._const.value]),!(_=t(o,h))||!_.childNodes)return!1;_.insertBefore(e,_.childNodes[m]||null);break;default:console.log("unknown action");}return f.newNode=e,n.postDiffApply(f),!0}function n(l,e,t){var o=l[e];l[e]=l[t],l[t]=o}function o(l,e,a){e.length||(e=[e]),(e=e.slice()).reverse(),e.forEach(function(e){!function(l,e,t){switch(e[t._const.action]){case t._const.addAttribute:e[t._const.action]=t._const.removeAttribute,R(l,e,t);break;case t._const.modifyAttribute:n(e,t._const.oldValue,t._const.newValue),R(l,e,t);break;case t._const.removeAttribute:e[t._const.action]=t._const.addAttribute,R(l,e,t);break;case t._const.modifyTextElement:case t._const.modifyValue:case t._const.modifyComment:case t._const.modifyChecked:case t._const.modifySelected:case t._const.replaceElement:n(e,t._const.oldValue,t._const.newValue),R(l,e,t);break;case t._const.relocateGroup:n(e,t._const.from,t._const.to),R(l,e,t);break;case t._const.removeElement:e[t._const.action]=t._const.addElement,R(l,e,t);break;case t._const.addElement:e[t._const.action]=t._const.removeElement,R(l,e,t);break;case t._const.removeTextElement:e[t._const.action]=t._const.addTextElement,R(l,e,t);break;case t._const.addTextElement:e[t._const.action]=t._const.removeTextElement,R(l,e,t);break;default:console.log("unknown action");}}(l,e,a)})}function i(o){var e=[];return e.push(o.nodeName),"#text"!==o.nodeName&&"#comment"!==o.nodeName&&o.attributes&&(o.attributes.class&&e.push(o.nodeName+"."+o.attributes.class.replace(/ /g,".")),o.attributes.id&&e.push(o.nodeName+"#"+o.attributes.id)),e}function l(n){var l={},t={};return n.forEach(function(o){i(o).forEach(function(o){var e=(o in l);e||o in t?e&&(delete l[o],t[o]=!0):l[o]=!0})}),l}function G(a,e){var t=l(a),o=l(e),n={};return Object.keys(t).forEach(function(t){o[t]&&(n[t]=!0)}),n}function c(t){return delete t.outerDone,delete t.innerDone,delete t.valueDone,!t.childNodes||t.childNodes.every(c)}function u(l,a){if(!["nodeName","value","checked","selected","data"].every(function(e){return l[e]===a[e]}))return!1;if(!!l.attributes!==!!a.attributes)return!1;if(!!l.childNodes!==!!a.childNodes)return!1;if(l.attributes){var e=Object.keys(l.attributes),t=Object.keys(a.attributes);if(e.length!==t.length)return!1;if(!e.every(function(e){return l.attributes[e]===a.attributes[e]}))return!1}if(l.childNodes){if(l.childNodes.length!==a.childNodes.length)return!1;if(!l.childNodes.every(function(t,e){return u(t,a.childNodes[e])}))return!1}return!0}function r(d,e,t,o,n){if(!d||!e)return!1;if(d.nodeName!==e.nodeName)return!1;if("#text"===d.nodeName)return!!n||d.data===e.data;if(d.nodeName in t)return!0;if(d.attributes&&e.attributes){if(d.attributes.id){if(d.attributes.id!==e.attributes.id)return!1;if(d.nodeName+"#"+d.attributes.id in t)return!0}if(d.attributes.class&&d.attributes.class===e.attributes.class&&d.nodeName+"."+d.attributes.class.replace(/ /g,".")in t)return!0}if(o)return!0;var c=d.childNodes?d.childNodes.slice().reverse():[],i=e.childNodes?e.childNodes.slice().reverse():[];if(c.length!==i.length)return!1;if(n)return c.every(function(o,e){return o.nodeName===i[e].nodeName});var a=G(c,i);return c.every(function(o,e){return r(o,i[e],a,!0,!0)})}function h(t){return JSON.parse(JSON.stringify(t))}function d(l,h,e,t){var o=0,n=[],g=l.length,a=h.length,c=Array.apply(void 0,Array(g+1)).map(function(){return[]}),u=G(l,h),d=g===a;d&&l.some(function(t,e){var o=i(t),n=i(h[e]);return o.length===n.length?(o.some(function(o,e){if(o!==n[e])return d=!1,!0}),!d||void 0):(d=!1,!0)});for(var N=0;N<g;N++)for(var y,v=l[N],m=0;m<a;m++)y=h[m],e[N]||t[m]||!r(v,y,u,d)?c[N+1][m+1]=0:(c[N+1][m+1]=c[N][m]?c[N][m]+1:1,c[N+1][m+1]>=o&&(o=c[N+1][m+1],n=[N+1,m+1]));return 0!==o&&{oldValue:n[0]-o,newValue:n[1]-o,length:o}}function p(o,e){return Array.apply(void 0,Array(o)).map(function(){return e})}function m(l,e){var a,d,i=l;for(e=e.slice();0<e.length;){if(!i.childNodes)return!1;d=e.splice(0,1)[0],a=i,i=i.childNodes[d]}return{node:i,parentNode:a,nodeIndex:d}}function f(n,e,l){return e.forEach(function(e){!function(p,_,t){var e,o,f,g=m(p,_[t._const.route]),a=g.node,V=g.parentNode,c=g.nodeIndex,r=[],u={diff:_,node:a};if(t.preVirtualDiffApply(u))return!0;switch(_[t._const.action]){case t._const.addAttribute:a.attributes||(a.attributes={}),a.attributes[_[t._const.name]]=_[t._const.value],"checked"===_[t._const.name]?a.checked=!0:"selected"===_[t._const.name]?a.selected=!0:"INPUT"===a.nodeName&&"value"===_[t._const.name]&&(a.value=_[t._const.value]);break;case t._const.modifyAttribute:a.attributes[_[t._const.name]]=_[t._const.newValue];break;case t._const.removeAttribute:delete a.attributes[_[t._const.name]],0===Object.keys(a.attributes).length&&delete a.attributes,"checked"===_[t._const.name]?a.checked=!1:"selected"===_[t._const.name]?delete a.selected:"INPUT"===a.nodeName&&"value"===_[t._const.name]&&delete a.value;break;case t._const.modifyTextElement:a.data=_[t._const.newValue];break;case t._const.modifyValue:a.value=_[t._const.newValue];break;case t._const.modifyComment:a.data=_[t._const.newValue];break;case t._const.modifyChecked:a.checked=_[t._const.newValue];break;case t._const.modifySelected:a.selected=_[t._const.newValue];break;case t._const.replaceElement:(e=h(_[t._const.newValue])).outerDone=!0,e.innerDone=!0,e.valueDone=!0,V.childNodes[c]=e;break;case t._const.relocateGroup:a.childNodes.splice(_[t._const.from],_.groupLength).reverse().forEach(function(o){return a.childNodes.splice(_[t._const.to],0,o)}),a.subsets&&a.subsets.forEach(function(o){if(_[t._const.from]<_[t._const.to]&&o.oldValue<=_[t._const.to]&&o.oldValue>_[t._const.from]){o.oldValue-=_.groupLength;var e=o.oldValue+o.length-_[t._const.to];0<e&&(r.push({oldValue:_[t._const.to]+_.groupLength,newValue:o.newValue+o.length-e,length:e}),o.length-=e)}else if(_[t._const.from]>_[t._const.to]&&o.oldValue>_[t._const.to]&&o.oldValue<_[t._const.from]){o.oldValue+=_.groupLength;var n=o.oldValue+o.length-_[t._const.to];0<n&&(r.push({oldValue:_[t._const.to]+_.groupLength,newValue:o.newValue+o.length-n,length:n}),o.length-=n)}else o.oldValue===_[t._const.from]&&(o.oldValue=_[t._const.to])});break;case t._const.removeElement:V.childNodes.splice(c,1),V.subsets&&V.subsets.forEach(function(t){t.oldValue>c?t.oldValue-=1:t.oldValue===c?t.delete=!0:t.oldValue<c&&t.oldValue+t.length>c&&(t.oldValue+t.length-1===c?t.length--:(r.push({newValue:t.newValue+c-t.oldValue,oldValue:c,length:t.length-c+t.oldValue-1}),t.length=c-t.oldValue))}),a=V;break;case t._const.addElement:o=_[t._const.route].slice(),f=o.splice(o.length-1,1)[0],a=m(p,o).node,(e=h(_[t._const.element])).outerDone=!0,e.innerDone=!0,e.valueDone=!0,a.childNodes||(a.childNodes=[]),f>=a.childNodes.length?a.childNodes.push(e):a.childNodes.splice(f,0,e),a.subsets&&a.subsets.forEach(function(o){if(o.oldValue>=f)o.oldValue+=1;else if(o.oldValue<f&&o.oldValue+o.length>f){var e=o.oldValue+o.length-f;r.push({newValue:o.newValue+o.length-e,oldValue:f+1,length:e}),o.length-=e}});break;case t._const.removeTextElement:V.childNodes.splice(c,1),"TEXTAREA"===V.nodeName&&delete V.value,V.subsets&&V.subsets.forEach(function(t){t.oldValue>c?t.oldValue-=1:t.oldValue===c?t.delete=!0:t.oldValue<c&&t.oldValue+t.length>c&&(t.oldValue+t.length-1===c?t.length--:(r.push({newValue:t.newValue+c-t.oldValue,oldValue:c,length:t.length-c+t.oldValue-1}),t.length=c-t.oldValue))}),a=V;break;case t._const.addTextElement:o=_[t._const.route].slice(),f=o.splice(o.length-1,1)[0],(e={}).nodeName="#text",e.data=_[t._const.value],(a=m(p,o).node).childNodes||(a.childNodes=[]),f>=a.childNodes.length?a.childNodes.push(e):a.childNodes.splice(f,0,e),"TEXTAREA"===a.nodeName&&(a.value=_[t._const.newValue]),a.subsets&&a.subsets.forEach(function(o){if(o.oldValue>=f&&(o.oldValue+=1),o.oldValue<f&&o.oldValue+o.length>f){var e=o.oldValue+o.length-f;r.push({newValue:o.newValue+o.length-e,oldValue:f+1,length:e}),o.length-=e}});break;default:console.log("unknown action");}a.subsets&&(a.subsets=a.subsets.filter(function(t){return!t.delete&&t.oldValue!==t.newValue}),r.length&&(a.subsets=a.subsets.concat(r))),u.newNode=e,t.postVirtualDiffApply(u)}(n,e,l)}),!0}function g(n,l){void 0===l&&(l={});var a={};return(a.nodeName=n.nodeName,"#text"===a.nodeName||"#comment"===a.nodeName)?a.data=n.data:(n.attributes&&0<n.attributes.length&&(a.attributes={},Array.prototype.slice.call(n.attributes).forEach(function(t){return a.attributes[t.name]=t.value})),"TEXTAREA"===a.nodeName?a.value=n.value:n.childNodes&&0<n.childNodes.length&&(a.childNodes=[],Array.prototype.slice.call(n.childNodes).forEach(function(t){return a.childNodes.push(g(t,l))})),l.valueDiffing&&(void 0!==n.checked&&n.type&&["radio","checkbox"].includes(n.type.toLowerCase())?a.checked=n.checked:void 0!==n.value&&(a.value=n.value),void 0!==n.selected&&(a.selected=n.selected))),a}function V(t){return t.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function y(d){var e={nodeName:"",attributes:{}},t=d.match(/<\/?([^\s]+?)[/\s>]/);if(t&&(e.nodeName=t[1].toUpperCase(),(w[t[1].toLowerCase()]||"/"===d.charAt(d.length-2))&&(e.voidElement=!0),e.nodeName.startsWith("!--"))){var o=d.indexOf("-->");return{type:"comment",data:-1===o?"":d.slice(4,o)}}for(var n=new RegExp(b),u=null,p=!1;!p;)if(null===(u=n.exec(d)))p=!0;else if(u[0].trim())if(u[1]){var r=u[1].trim(),l=[r,""];-1<r.indexOf("=")&&(l=r.split("=")),e.attributes[l[0]]=l[1],n.lastIndex--}else u[2]&&(e.attributes[u[2]]=u[3].trim().substring(1,u[3].length-1));return e}function v(t){return function n(o){return delete o.voidElement,o.childNodes&&o.childNodes.forEach(function(e){return n(e)}),o}(function(g,e){void 0===e&&(e={components:N});var v,b=[],n=-1,E=[],i=!1;return g.replace(_,function(t,o){if(i){if(t!=="</"+v.nodeName+">")return;i=!1}var l,a="/"!==t.charAt(1),c=t.startsWith("<!--"),d=o+t.length,u=g.charAt(d);if(c){var h=y(t);return 0>n?(b.push(h),b):((l=E[n])&&(l.childNodes||(l.childNodes=[]),l.childNodes.push(h)),b)}if(a&&(v=y(t),n++,"tag"===v.type&&e.components[v.nodeName]&&(v.type="component",i=!0),v.voidElement||i||!u||"<"===u||(v.childNodes||(v.childNodes=[]),v.childNodes.push({nodeName:"#text",data:V(g.slice(d,g.indexOf("<",d)))})),0==n&&b.push(v),(l=E[n-1])&&(l.childNodes||(l.childNodes=[]),l.childNodes.push(v)),E[n]=v),(!a||v.voidElement)&&(n--,!i&&"<"!==u&&u)){l=-1===n?b:E[n].childNodes||[];var p=g.indexOf("<",d),m=V(g.slice(d,-1===p?void 0:p));l.push({nodeName:"#text",data:m})}}),b[0]}(t))}var x=function(o){var l=this;void 0===o&&(o={}),Object.entries(o).forEach(function(t){var e=t[0],o=t[1];return l[e]=o})};x.prototype.toString=function(){return JSON.stringify(this)},x.prototype.setValue=function(o,e){return this[o]=e,this};var a=function(){this.list=[]};a.prototype.add=function(o){var e;(e=this.list).push.apply(e,o)},a.prototype.forEach=function(o){this.list.forEach(function(e){return o(e)})};var _=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,N=Object.create?Object.create(null):{},b=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g,w={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},E=function(n,e,t){this.options=t,this.t1=n instanceof HTMLElement?g(n,this.options):"string"==typeof n?v(n,this.options):JSON.parse(JSON.stringify(n)),this.t2=e instanceof HTMLElement?g(e,this.options):"string"==typeof e?v(e,this.options):JSON.parse(JSON.stringify(e)),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=g(n,this.options),this.t2Orig=g(e,this.options)),this.tracker=new a};E.prototype.init=function(){return this.findDiffs(this.t1,this.t2)},E.prototype.findDiffs=function(n,e){var t;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));0===(t=this.findNextDiff(n,e,[])).length&&(u(n,e)||(this.foundAll?console.error("Could not find remaining diffs!"):(this.foundAll=!0,c(n),t=this.findNextDiff(n,e,[])))),0<t.length&&(this.foundAll=!1,this.tracker.add(t),f(n,t,this.options))}while(0<t.length);return this.tracker.list},E.prototype.findNextDiff=function(l,e,t){var o,a;if(this.options.maxDepth&&t.length>this.options.maxDepth)return[];if(!l.outerDone){if(o=this.findOuterDiff(l,e,t),this.options.filterOuterDiff&&(a=this.options.filterOuterDiff(l,e,o))&&(o=a),0<o.length)return l.outerDone=!0,o;l.outerDone=!0}if(!l.innerDone){if(0<(o=this.findInnerDiff(l,e,t)).length)return o;l.innerDone=!0}if(this.options.valueDiffing&&!l.valueDone){if(0<(o=this.findValueDiff(l,e,t)).length)return l.valueDone=!0,o;l.valueDone=!0}return[]},E.prototype.findOuterDiff=function(a,e,t){var o,d,p,m,_,f,g=[];if(a.nodeName!==e.nodeName){if(!t.length)throw new Error("Top level nodes have to be of the same kind.");return[new x().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(a)).setValue(this.options._const.newValue,h(e)).setValue(this.options._const.route,t)]}if(t.length&&this.options.maxNodeDiffCount<S((a.childNodes||[]).length-(e.childNodes||[]).length))return[new x().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(a)).setValue(this.options._const.newValue,h(e)).setValue(this.options._const.route,t)];if(a.data!==e.data)return"#text"===a.nodeName?[new x().setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,t).setValue(this.options._const.oldValue,a.data).setValue(this.options._const.newValue,e.data)]:[new x().setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,t).setValue(this.options._const.oldValue,a.data).setValue(this.options._const.newValue,e.data)];for(d=a.attributes?Object.keys(a.attributes).sort():[],p=e.attributes?Object.keys(e.attributes).sort():[],m=d.length,f=0;f<m;f++)o=d[f],-1===(_=p.indexOf(o))?g.push(new x().setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,t).setValue(this.options._const.name,o).setValue(this.options._const.value,a.attributes[o])):(p.splice(_,1),a.attributes[o]!==e.attributes[o]&&g.push(new x().setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,t).setValue(this.options._const.name,o).setValue(this.options._const.oldValue,a.attributes[o]).setValue(this.options._const.newValue,e.attributes[o])));for(m=p.length,f=0;f<m;f++)o=p[f],g.push(new x().setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,t).setValue(this.options._const.name,o).setValue(this.options._const.value,e.attributes[o]));return g},E.prototype.findInnerDiff=function(a,e,t){var o=a.childNodes?a.childNodes.slice():[],n=e.childNodes?e.childNodes.slice():[],m=Math.max(o.length,n.length),i=S(o.length-n.length),f=[],N=0;if(!this.options.maxChildCount||m<this.options.maxChildCount){var y=a.subsets&&a.subsetsAge--,v=y?a.subsets:a.childNodes&&e.childNodes?function(u,e){for(var t=u.childNodes?u.childNodes:[],o=e.childNodes?e.childNodes:[],n=p(t.length,!1),r=p(o.length,!1),i=[],a=!0,h=function(){return arguments[1]};a;)(a=d(t,o,n,r))&&(i.push(a),Array.apply(void 0,Array(a.length)).map(h).forEach(function(o){return e=o,n[a.oldValue+e]=!0,void(r[a.newValue+e]=!0);var e}));return u.subsets=i,u.subsetsAge=100,i}(a,e):[];if(0<v.length&&0<(f=this.attemptGroupRelocation(a,e,v,t,y)).length)return f}for(var b=0;b<m;b+=1){var E=o[b],V=n[b];i&&(E&&!V?"#text"===E.nodeName?(f.push(new x().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,t.concat(N)).setValue(this.options._const.value,E.data)),N-=1):(f.push(new x().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,t.concat(N)).setValue(this.options._const.element,h(E))),N-=1):V&&!E&&("#text"===V.nodeName?f.push(new x().setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,t.concat(N)).setValue(this.options._const.value,V.data)):f.push(new x().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,t.concat(N)).setValue(this.options._const.element,h(V))))),E&&V&&(!this.options.maxChildCount||m<this.options.maxChildCount?f=f.concat(this.findNextDiff(E,V,t.concat(N))):u(E,V)||(o.length>n.length?("#text"===E.nodeName?f.push(new x().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,t.concat(N)).setValue(this.options._const.value,E.data)):f.push(new x().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,h(E)).setValue(this.options._const.route,t.concat(N))),o.splice(b,1),b-=1,N-=1,i-=1):o.length<n.length?(f=f.concat([new x().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,h(V)).setValue(this.options._const.route,t.concat(N))]),o.splice(b,0,{}),i-=1):f=f.concat([new x().setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,h(E)).setValue(this.options._const.newValue,h(V)).setValue(this.options._const.route,t.concat(N))]))),N+=1}return a.innerDone=!0,f},E.prototype.attemptGroupRelocation=function(a,e,t,o,n){for(var m,f,y,E,D,k,A=function(l,e,t){var o=l.childNodes?p(l.childNodes.length,!0):[],n=e.childNodes?p(e.childNodes.length,!0):[],d=0;return t.forEach(function(i){for(var e=i.oldValue+i.length,t=i.newValue+i.length,c=i.oldValue;c<e;c+=1)o[c]=d;for(var u=i.newValue;u<t;u+=1)n[u]=d;d+=1}),{gaps1:o,gaps2:n}}(a,e,t),C=A.gaps1,_=A.gaps2,V=L(C.length,_.length),T=[],v=0,O=0;v<V;O+=1,v+=1)if(!(!n||!0!==C[v]&&!0!==_[v]));else if(!0===C[v]){if("#text"!==(E=a.childNodes[O]).nodeName)T.push(new x().setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,o.concat(v)).setValue(this.options._const.element,h(E))),C.splice(v,1),V=L(C.length,_.length),v-=1;else if("#text"!==e.childNodes[v].nodeName)T.push(new x().setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,o.concat(v)).setValue(this.options._const.value,E.data)),C.splice(v,1),V=L(C.length,_.length),v-=1;else if(E.data!==e.childNodes[v].data){for(k=O;a.childNodes.length>k+1&&"#text"===a.childNodes[k+1].nodeName;)if(k+=1,e.childNodes[v].data===a.childNodes[k].data){D=!0;break}if(!D)return T.push(new x().setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,o.concat(v)).setValue(this.options._const.oldValue,E.data).setValue(this.options._const.newValue,e.childNodes[v].data)),T}}else if(!0===_[v])"#text"===(E=e.childNodes[v]).nodeName?(T.push(new x().setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,o.concat(v)).setValue(this.options._const.value,E.data)),C.splice(v,0,!0),V=L(C.length,_.length),O-=1):(T.push(new x().setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,o.concat(v)).setValue(this.options._const.element,h(E))),C.splice(v,0,!0),V=L(C.length,_.length),O-=1);else if(C[v]!==_[v]){if(0<T.length)return T;if(y=t[C[v]],(f=L(y.newValue,a.childNodes.length-y.length))!==y.oldValue){m=!1;for(var S=0;S<y.length;S+=1)r(a.childNodes[f+S],a.childNodes[y.oldValue+S],[],!1,!0)||(m=!0);if(m)return[new x().setValue(this.options._const.action,this.options._const.relocateGroup).setValue("groupLength",y.length).setValue(this.options._const.from,y.oldValue).setValue(this.options._const.to,f).setValue(this.options._const.route,o)]}}return T},E.prototype.findValueDiff=function(l,e,t){var o=[];return l.selected!==e.selected&&o.push(new x().setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,l.selected).setValue(this.options._const.newValue,e.selected).setValue(this.options._const.route,t)),(l.value||e.value)&&l.value!==e.value&&"OPTION"!==l.nodeName&&o.push(new x().setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,l.value||"").setValue(this.options._const.newValue,e.value||"").setValue(this.options._const.route,t)),l.checked!==e.checked&&o.push(new x().setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,l.checked).setValue(this.options._const.newValue,e.checked).setValue(this.options._const.route,t)),o};var k={debug:!1,diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff:function(l,e,t,o){l.data=o},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1,_const:!1,document:window&&window.document&&window.document},e=function(n){var l=this;if(void 0===n&&(n={}),this.options=n,Object.entries(k).forEach(function(t){var e=t[0],o=t[1];Object.prototype.hasOwnProperty.call(l.options,e)||(l.options[e]=o)}),!this.options._const){var t=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"];this.options._const={},this.options.compress?t.forEach(function(t,e){return l.options._const[t]=e}):t.forEach(function(t){return l.options._const[t]=t})}this.DiffFinder=E};e.prototype.apply=function(o,e){return function(n,e,l){return e.every(function(e){return R(n,e,l)})}(o,e,this.options)},e.prototype.undo=function(n,e){return o(n,e,this.options)},e.prototype.diff=function(o,e){return new this.DiffFinder(o,e,this.options).init()};var D=function(l){var d=this;void 0===l&&(l={}),this.pad="\u2502   ",this.padding="",this.tick=1,this.messages=[];var t=function(t,e){var o=t[e];t[e]=function(){for(var n=[],l=arguments.length;l--;)n[l]=arguments[l];d.fin(e,Array.prototype.slice.call(n));var c=o.apply(t,n);return d.fout(e,c),c}};for(var o in l)"function"==typeof l[o]&&t(l,o);this.log("\u250C TRACELOG START")};return D.prototype.fin=function(o,e){this.padding+=this.pad,this.log("\u251C\u2500> entering "+o,e)},D.prototype.fout=function(o,e){this.log("\u2502<\u2500\u2500\u2518 generated return value",e),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)},D.prototype.format=function(o,e){return function(t){for(t=""+t;4>t.length;)t="0"+t;return t}(e)+"> "+this.padding+o},D.prototype.log=function(){var o=Array.prototype.slice.call(arguments),n=function(t){return t?"string"==typeof t?t:t instanceof HTMLElement?t.outerHTML||"<empty>":t instanceof Array?"["+t.map(n).join(",")+"]":t.toString()||t.valueOf()||"<unknown>":"<falsey>"};o=o.map(n).join(", "),this.messages.push(this.format(o,this.tick++))},D.prototype.toString=function(){for(var o="\u2514\u2500\u2500\u2500";o.length<=this.padding.length+this.pad.length;)o+="\xD7   ";var n=this.padding;return this.padding="",o=this.format(o,this.tick),this.padding=n,this.messages.join("\n")+"\n"+o},C.DiffDOM=e,C.TraceLogger=D,C.nodeToObj=g,C.stringToObj=v,C}({});if("undefined"==typeof EventEmitter){var EventEmitter=function(){this.events={}};EventEmitter.prototype.on=function(e,t){"object"!=typeof this.events[e]&&(this.events[e]=[]),this.events[e].push(t)},EventEmitter.prototype.removeListener=function(e,t){var o;"object"==typeof this.events[e]&&(o=indexOf(this.events[e],t),-1<o&&this.events[e].splice(o,1))},EventEmitter.prototype.emit=function(e){var t,o,n,l=[].slice.call(arguments,1);if("object"==typeof this.events[e])for(o=this.events[e].slice(),n=o.length,t=0;t<n;t++)o[t].apply(this,l)},EventEmitter.prototype.once=function(e,t){this.on(e,function o(){this.removeListener(e,o),t.apply(this,arguments)})},EventEmitter.prototype.off=function(e){"object"==typeof this.events[e]&&delete this.events[e]}}DEV_SYNC.eventbus=new EventEmitter;function ready(e){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}function debounce(e,t=0){let o;return(...n)=>{o&&clearTimeout(o),o=setTimeout(()=>e(...n),t)}}function uniqid(){var e=Math.floor,t=e(11*Math.random()),o=e(1e6*Math.random());return String.fromCharCode(t)+o}(function(){const e=DEV_SYNC.debug?console.log:()=>{},t=new SharedWorker(DEV_SYNC.worker);t.port.start(),t.port.onmessage=function(t){if(e("Message",t.data),"error"===t.data.type)return void console.warn("Dev sync server connection error. Start or restart the server and reload the page if needed.");if("message"===t.data.type){const o=JSON.parse(t.data.msg);return-1===o.path.indexOf("~")?void DEV_SYNC.eventbus.emit("message",o):void e("ignored")}},t.port.postMessage(DEV_SYNC.stream)})(),function(){function e(e){return e=e.replace(window.location.origin,""),e=e.split("?")[0],e}function t(t){for(let o of document.styleSheets)if(o.href&&t===e(o.href))return o}function o(e){s=t(e)&&s.remove()}function n(e){if(s=t(e),s)s.ownerNode.href=e+"?v="+uniqid();else if(-1!==d.indexOf(e)){let t=document.createElement("link");t.href=e,t.rel="stylesheet",document.head.appendChild(t)}else a("stylesheet detected, but not loaded")}function l(){a("REFRESHING STYLESHEETS",i),i.forEach((e,t)=>{console.log(e,t),"REMOVE"===e?o(t):n(t),i.delete(t)})}const a=DEV_SYNC.debug?console.log:()=>{};let d=[],i=new Map;ready(function(){for(let t of document.styleSheets)t.href&&d.push(e(t.href));const t=debounce(l,250);DEV_SYNC.eventbus.on("message",function(e){".css"===e.ext&&(i.set(e.path,e.type),t())})})}(),function(){let e=[],t=new diffDOM.DiffDOM,o=null;const n=debounce(()=>{o&&o.abort(),o=new AbortController;var e=o.signal;fetch(window.location.href,{signal:e}).then(e=>{o=null,e.text().then(l)}).catch(()=>{o=null})}),l=debounce(o=>{const n=new DOMParser,l=n.parseFromString(o,"text/html");e.map(e=>{const o=document.querySelector(e),n=l.querySelector(e);if(o&&n){const e=t.diff(o,n);t.apply(o,e)}})});ready(function(){DEV_SYNC.eventbus.on("message",function(t){"CHMOD"===t.type||(e=t.html.selectors,t.html.extensions.includes(t.ext)&&n())})})}();var DomOutline=function(e){var t=Math.max;function o(e){var t=document.createElement("style");t.type="text/css",document.getElementsByTagName("head")[0].appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e}function n(){if(!0!==m.initialized){var e="."+m.opts.namespace+" {    background: #09c;    position: absolute;    z-index: 1000000;}."+m.opts.namespace+"_label {    background: #09c;    border-radius: 2px;    color: #fff;    font: bold 12px/12px Helvetica, sans-serif;    padding: 4px 6px;    position: absolute;    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.25);    z-index: 1000001;}";o(e),m.initialized=!0}}function l(){var e=document.createElement("div");e.classList.add(m.opts.namespace+"_label");var t=document.createElement("div");t.classList.add(m.opts.namespace);var o=document.createElement("div");o.classList.add(m.opts.namespace);var n=document.createElement("div");n.classList.add(m.opts.namespace);var l=document.createElement("div");l.classList.add(m.opts.namespace);var a=document.querySelector("body");m.elements.label=a.appendChild(e),m.elements.top=a.appendChild(t),m.elements.bottom=a.appendChild(o),m.elements.left=a.appendChild(n),m.elements.right=a.appendChild(l)}function a(){[].forEach.call(m.elements,function(e,t){t.remove()})}function d(e,t,o){var n=Math.round,l=e.tagName.toLowerCase();return e.id&&(l+="#"+e.id),e.className&&(l+=("."+e.className.trim().replace(/ /g,".")).replace(/\.\.+/g,".")),l+" ("+n(t)+"x"+n(o)+")"}function i(){return m.elements.window||(m.elements.window=window),scrollTop=void 0===window.pageYOffset?(document.documentElement||document.body.parentNode||document.body).scrollTop:window.pageYOffset,scrollTop}function c(o){if(-1===o.target.className.indexOf(m.opts.namespace)&&!(m.opts.filter&&!o.target.tagName===m.opts.filter)){h.element=o.target;var e=m.opts.borderWidth,n=i(o),l=h.element.getBoundingClientRect(),a=l.top+n,c=d(h.element,l.width,l.height),u=t(0,a-20-e,n)+"px",p=t(0,l.left-e)+"px";m.elements.label.style.top=u,m.elements.label.style.left=p,m.elements.label.textContent=c,m.elements.top.style.top=t(0,a-e)+"px",m.elements.top.style.left=l.left-e+"px",m.elements.top.style.width=l.width+e+"px",m.elements.top.style.height=e+"px",m.elements.bottom.style.top=a+l.height+"px",m.elements.bottom.style.left=l.left-e+"px",m.elements.bottom.style.width=l.width+e+"px",m.elements.bottom.style.height=e+"px",m.elements.left.style.top=a-e+"px",m.elements.left.style.left=t(0,l.left-e)+"px",m.elements.left.style.width=e+"px",m.elements.left.style.height=l.height+e+"px",m.elements.right.style.top=a-e+"px",m.elements.right.style.left=l.left+l.width+"px",m.elements.right.style.width=e+"px",m.elements.right.style.height=l.height+2*e+"px"}}function u(t){return(t.keyCode===m.keyCodes.ESC||t.keyCode===m.keyCodes.BACKSPACE||t.keyCode===m.keyCodes.DELETE)&&h.stop(),!1}function p(t){return m.opts.dontStop||h.stop(),m.opts.onClick.call(h.element,t),!1}function r(t){return!(m.opts.filter&&!t.target.tagName===m.opts.filter)&&void p.call(this,t)}e=e||{};var h={},m={opts:{namespace:e.namespace||"DomOutline",borderWidth:e.borderWidth||2,onClick:e.onClick||!1,filter:e.filter||!1,dontStop:!e.stopOnClick||!1},keyCodes:{BACKSPACE:8,ESC:27,DELETE:46},active:!1,initialized:!1,elements:{}};return h.start=function(){if(n(),!0!==m.active){m.active=!0,l();var e=document.querySelector("body");e.addEventListener("mousemove",c),e.addEventListener("keyup",u),m.opts.onClick&&setTimeout(function(){e.addEventListener("click",r)},50)}},h.stop=function(){m.active=!1,a();var e=document.querySelector("body");e.removeEventListener("mousemove",c),e.removeEventListener("keyup",u),e.removeEventListener("click",r)},h};